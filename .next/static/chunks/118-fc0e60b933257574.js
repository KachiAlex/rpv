"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[118],{1827:function(e,t,r){r.r(t),r.d(t,{getFirebase:function(){return i}});var n=r(738),a=r(5978);let o=null,s=null;function i(){let e="AIzaSyDYTudeKDSvY_IrwI5nookV0cv828uAAvU";return e?(o||(o=(0,n.ZF)({apiKey:e,authDomain:"redemptionprojectversion.firebaseapp.com",projectId:"redemptionprojectversion",storageBucket:"redemptionprojectversion.firebasestorage.app",messagingSenderId:"262491376013",appId:"1:262491376013:web:edc2194e6bb7819294d5c4"}),s=(0,a.ad)(o)),{app:o,db:s}):{app:null,db:null}}},2118:function(e,t,r){r.d(t,{R:function(){return d}});var n=r(9625),a=r(5978),o=r(1827);class s{getDb(){let{db:e}=(0,o.getFirebase)();if(!e)throw Error("Firebase not initialized. Please check your Firebase configuration.");return e}async getTranslation(e){var t,r;let n=this.getDb(),o=(0,a.JU)(n,"translations",e),s=await (0,a.QT)(o);if(!s.exists())return null;let i=s.data();return{...i,createdAt:null===(t=i.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=i.updatedAt)||void 0===r?void 0:r.toDate()}}async saveTranslation(e){let t=this.getDb(),r=(0,a.JU)(t,"translations",e.id),n=a.EK.now(),o={...e,createdAt:e.createdAt?a.EK.fromDate(e.createdAt):n,updatedAt:n};await (0,a.pl)(r,o,{merge:!0})}async getAllTranslations(){let e=this.getDb(),t=(0,a.IO)((0,a.hJ)(e,"translations"));return(await (0,a.PL)(t)).docs.map(e=>{var t,r;let n=e.data();return{...n,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=n.updatedAt)||void 0===r?void 0:r.toDate()}})}subscribeToTranslation(e,t){let r=this.getDb(),n=(0,a.JU)(r,"translations",e);return(0,a.cf)(n,e=>{var r,n;if(!e.exists()){t(null);return}let a=e.data();t({...a,createdAt:null===(r=a.createdAt)||void 0===r?void 0:r.toDate(),updatedAt:null===(n=a.updatedAt)||void 0===n?void 0:n.toDate()})})}subscribeToAllTranslations(e){let t=this.getDb(),r=(0,a.IO)((0,a.hJ)(t,"translations"));return(0,a.cf)(r,t=>{e(t.docs.map(e=>{var t,r;let n=e.data();return{...n,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),updatedAt:null===(r=n.updatedAt)||void 0===r?void 0:r.toDate()}}))})}async getProjectionChannel(e){var t;let r=this.getDb(),n=(0,a.JU)(r,"channels",e),o=await (0,a.QT)(n);if(!o.exists())return null;let s=o.data();return{...s,timestamp:null===(t=s.timestamp)||void 0===t?void 0:t.toDate()}}async saveProjectionChannel(e,t){let r=this.getDb(),n=(0,a.JU)(r,"channels",e),o={...t,timestamp:t.timestamp?a.EK.fromDate(t.timestamp):a.EK.now()};await (0,a.pl)(n,o,{merge:!0})}subscribeToProjectionChannel(e,t){let r=this.getDb(),n=(0,a.JU)(r,"channels",e);return(0,a.cf)(n,e=>{var r;if(!e.exists()){t(null);return}let n=e.data();t({...n,timestamp:null===(r=n.timestamp)||void 0===r?void 0:r.toDate()})})}}class i{async getTranslation(e){try{return await this.repository.getTranslation(e)}catch(e){throw console.error("Error getting translation:",e),e}}async getAllTranslations(){try{return await this.repository.getAllTranslations()}catch(e){throw console.error("Error getting all translations:",e),e}}async saveTranslation(e){try{let t=new Date,r={...e,createdAt:e.createdAt||t,updatedAt:t};await this.repository.saveTranslation(r)}catch(e){throw console.error("Error saving translation:",e),e}}async mergeTranslation(e){try{let t=await this.getTranslation(e.id);if(!t)return await this.saveTranslation(e),e;let r=this.mergeTranslations(t,e);return await this.saveTranslation(r),r}catch(e){throw console.error("Error merging translation:",e),e}}async addOrUpdateVerse(e,t,r,n,a){try{let o=await this.getTranslation(e);if(!o){await this.saveTranslation({id:e,name:e,books:[{name:t,chapters:[{number:r,verses:[{number:n,text:a}]}]}]});return}let s=this.addVerseToTranslation(o,t,r,n,a);await this.saveTranslation(s)}catch(e){throw console.error("Error adding/updating verse:",e),e}}mergeTranslations(e,t){let r;let n=e.books.find(e=>{var r;return e.name===(null===(r=t.books[0])||void 0===r?void 0:r.name)});if(n){let a=t.books[0],o=[...n.chapters];a.chapters.forEach(e=>{let t=o.findIndex(t=>t.number===e.number);if(t>=0){let r=o[t],n=[...r.verses];e.verses.forEach(e=>{let t=n.findIndex(t=>t.number===e.number);t>=0?n[t]=e:n.push(e)}),n.sort((e,t)=>e.number-t.number),o[t]={...r,verses:n}}else o.push(e)}),o.sort((e,t)=>e.number-t.number),r=e.books.map(e=>e.name===n.name?{...e,chapters:o}:e)}else r=[...e.books,t.books[0]];return{...e,name:t.name||e.name,books:r,updatedAt:new Date}}addVerseToTranslation(e,t,r,n,a){let o=e.books.find(e=>e.name===t);if(o){let e=o.chapters.find(e=>e.number===r);if(e){let t=e.verses.find(e=>e.number===n);t?t.text=a:(e.verses.push({number:n,text:a}),e.verses.sort((e,t)=>e.number-t.number))}else o.chapters.push({number:r,verses:[{number:n,text:a}]}),o.chapters.sort((e,t)=>e.number-t.number)}else e.books.push({name:t,chapters:[{number:r,verses:[{number:n,text:a}]}]});return{...e,updatedAt:new Date}}subscribeToTranslation(e,t){return this.repository.subscribeToTranslation(e,t)}subscribeToAllTranslations(e){return this.repository.subscribeToAllTranslations(e)}constructor(){this.repository=new s}}class l{async sendToProjector(e,t){try{let{current:r}=d.getState();if(!r)return;let n=r.books.find(e=>e.name===t.book),a=null==n?void 0:n.chapters.find(e=>e.number===t.chapter),o=null==a?void 0:a.verses.find(e=>e.number===t.verse),s={translation:r.name,book:t.book,chapter:t.chapter,verse:t.verse,text:(null==o?void 0:o.text)||"",timestamp:new Date};await this.repository.saveProjectionChannel(e,s)}catch(e){throw console.error("Error sending to projector:",e),e}}subscribeToChannel(e,t){return this.repository.subscribeToProjectionChannel(e,t)}async getChannel(e){try{return await this.repository.getProjectionChannel(e)}catch(e){throw console.error("Error getting channel:",e),e}}constructor(){this.repository=new s}}let c={id:"sample",name:"Sample Translation",books:[{name:"John",chapters:[{number:3,verses:[{number:16,text:"For God so loved the world, that he gave his only Son, that whoever believes in him should not perish but have eternal life."}]}]}]},d=(0,n.Ue)((e,t)=>{let n=new i,a=new l;return{translations:[],current:null,projectorRef:{translation:"",book:"",chapter:0,verse:0,text:""},channelId:"default",isLoading:!1,error:null,_translationService:n,_projectionService:a,_unsubscribers:{},loadTranslations:async()=>{e({isLoading:!0,error:null});try{let{db:o}=await Promise.resolve().then(r.bind(r,1827)).then(e=>e.getFirebase());if(!o){t().loadSample(),e({isLoading:!1});return}let s=await n.getAllTranslations();if(0===s.length)t().loadSample();else{var a;e({translations:s,current:null!==(a=s[0])&&void 0!==a?a:null,isLoading:!1})}let i=n.subscribeToAllTranslations(r=>{var n,a;e({translations:r,current:null!==(a=null!==(n=t().current)&&void 0!==n?n:r[0])&&void 0!==a?a:null})}),l=t()._unsubscribers;l.translations&&l.translations(),l.translations=i}catch(r){console.error("Error loading translations:",r),e({error:r instanceof Error?r.message:"Failed to load translations",isLoading:!1}),t().loadSample()}},loadSample:()=>{0===t().translations.length&&e({translations:[c],current:c})},setCurrent:r=>{var n;e({current:null!==(n=t().translations.find(e=>e.id===r))&&void 0!==n?n:null})},setReference:e=>{},setChannelId:r=>{e({channelId:r}),t().subscribeToChannel()},sendToProjector:async e=>{try{let{current:r,channelId:n}=t();if(!r)return;await a.sendToProjector(n||"default",e)}catch(o){console.error("Error sending to projector:",o);let{current:n,channelId:a}=t();if(n){var r;let t=n.books.find(t=>t.name===e.book),o=null==t?void 0:t.chapters.find(t=>t.number===e.chapter),s=null==o?void 0:o.verses.find(t=>t.number===e.verse),i={translation:n.name,book:e.book,chapter:e.chapter,verse:e.verse,text:null!==(r=null==s?void 0:s.text)&&void 0!==r?r:""};localStorage.setItem("rpv:projector:".concat(a||"default"),JSON.stringify(i)),window.dispatchEvent(new StorageEvent("storage",{key:"rpv:projector:".concat(a||"default")}))}}},subscribeToChannel:()=>{let{channelId:n,_projectionService:a}=t(),o=n||"default",s=t()._unsubscribers;s.channel&&s.channel();let{getFirebase:i}=r(1827),{db:l}=i();if(l)try{let t=a.subscribeToChannel(o,t=>{t&&e({projectorRef:t})});s.channel=t;return}catch(e){console.error("Error subscribing to Firestore channel:",e)}let c=()=>{try{let t=localStorage.getItem("rpv:projector:".concat(o));t&&e({projectorRef:JSON.parse(t)})}catch(e){}};c();let d=e=>{e.key==="rpv:projector:".concat(o)&&c()};window.addEventListener("storage",d),s.channel=()=>{window.removeEventListener("storage",d)}},importJson:async r=>{var n,a,o,s;try{let o=null!==(n=r.translations)&&void 0!==n?n:[],{_translationService:s}=t();for(let e of o)await s.saveTranslation(e);e({translations:o,current:null!==(a=o[0])&&void 0!==a?a:null})}catch(n){console.error("Error importing JSON:",n);let t=null!==(o=r.translations)&&void 0!==o?o:[];e({translations:t,current:null!==(s=t[0])&&void 0!==s?s:null})}},mergeTranslation:async r=>{try{var n,a;let{_translationService:o}=t(),s=await o.mergeTranslation(r),i=t(),l=i.translations.findIndex(e=>e.id===r.id);if(l>=0){let t=[...i.translations];t[l]=s,e({translations:t,current:(null===(n=i.current)||void 0===n?void 0:n.id)===r.id?s:i.current})}else e({translations:[...i.translations,s],current:null!==(a=i.current)&&void 0!==a?a:s})}catch(e){throw console.error("Error merging translation:",e),e}},addOrUpdateVerse:async e=>{let{translationId:r,book:n,chapter:a,verse:o,text:s}=e;try{let{_translationService:e}=t();await e.addOrUpdateVerse(r,n,a,o,s),await t().loadTranslations()}catch(e){throw console.error("Error adding/updating verse:",e),e}}}})}}]);