(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{6942:function(e,t,r){Promise.resolve().then(r.bind(r,7837))},8728:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return l.a}});var a=r(2972),l=r.n(a)},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},7837:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});var a=r(7437),l=r(2265),s=r(7809),n=r(9205);let o=(0,n.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),d=(0,n.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var i=r(4756),c=r(401),u=r(8867),h=r(8728),x=r(2759);function m(e){let{verses:t,translationName:r,onCopy:s}=e,[n,o]=(0,l.useState)(!1),[d,i]=(0,l.useState)(!1),[m,b]=(0,l.useState)({includeReference:!0,includeTranslation:!1,format:"default",separator:"\n\n"}),p=async()=>{let e=t.map(e=>{let{verse:t,book:a,chapter:l}=e;return{book:a,chapter:l,verse:t.number,text:t.text,translationName:r}}),a=(0,x.Xm)(e,m);await (0,x.vQ)(a)?(o(!0),setTimeout(()=>o(!1),2e3),null==s||s()):alert("Failed to copy verses. Please try again.")};return 0===t.length?null:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 rounded-md bg-brand-600 text-white hover:bg-brand-700 transition-colors",title:"Copy selected verses with references",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{size:18}),(0,a.jsx)("span",{children:"Copied!"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{size:18}),(0,a.jsxs)("span",{children:["Copy ",t.length," ",1===t.length?"verse":"verses"]})]})}),(0,a.jsx)("button",{onClick:()=>i(!d),className:"absolute right-0 top-0 p-2 text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300",title:"Copy options",children:(0,a.jsx)(h.Z,{size:16})}),d&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-neutral-800 border rounded-lg shadow-lg p-4 z-50 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Format"}),(0,a.jsxs)("select",{value:m.format,onChange:e=>b({...m,format:e.target.value}),className:"w-full rounded-md border p-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100",children:[(0,a.jsx)("option",{value:"default",children:"Default (Book Chapter:Verse - Text)"}),(0,a.jsx)("option",{value:"compact",children:"Compact (Book Chapter:Verse Text)"}),(0,a.jsx)("option",{value:"full",children:"Full (Book Chapter:Verse\\nText)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"includeTranslation",checked:m.includeTranslation,onChange:e=>b({...m,includeTranslation:e.target.checked}),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"includeTranslation",className:"text-sm",children:"Include translation name"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"includeReference",checked:m.includeReference,onChange:e=>b({...m,includeReference:e.target.checked}),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"includeReference",className:"text-sm",children:"Include verse references"})]}),(0,a.jsx)("button",{onClick:p,className:"w-full bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700",children:"Copy with Options"})]})]})}var b=r(3800),p=r(3144);let v=(0,n.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),g=(0,n.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var f=r(2489);class k{parseQuery(e){let t;let r=e.trim(),a=[],l=[],s=/"([^"]+)"/g,n=r;for(;null!==(t=s.exec(r));)a.push(t[1]),n=n.replace(t[0],"");let o=n.toUpperCase(),d=o.includes(" AND "),i=o.includes(" OR ");return(n.match(/\b\w+\b/g)||[]).forEach(e=>{let t=e.toUpperCase();"AND"!==t&&"OR"!==t&&l.push(e)}),{phrases:a,words:l,operators:[],useAnd:d&&!i}}calculateMatchScore(e,t,r,a){let l=e.toLowerCase(),s=0;if(r.forEach(e=>{let t=e.toLowerCase();if(l.includes(t)){s+=100;let e=(l.match(RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"))||[]).length;s+=10*e}}),a.forEach(e=>{let t=e.toLowerCase(),r=RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),"gi"),a=(l.match(r)||[]).length;a>0&&(s+=50*a,l.startsWith(t+" ")&&(s+=20))}),0===r.length&&1===a.length){let e=t.toLowerCase();l.includes(e)&&l===e&&(s+=200)}return s}searchInTranslations(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{limit:a=500,includeContext:l=!1,caseSensitive:s=!1}=r,n=[],{phrases:o,words:d,useAnd:i}=this.parseQuery(t.trim());if(0===o.length&&0===d.length)return n;for(let r of e)for(let e of r.books)for(let c of e.chapters)for(let u of c.verses){let h=s?u.text:u.text.toLowerCase(),x=0===o.length||o.every(e=>{let t=s?e:e.toLowerCase();return h.includes(t)}),m=!1;if(m=0===d.length||(i?d.every(e=>{let t=s?e:e.toLowerCase();return new RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),s?"g":"gi").test(h)}):d.some(e=>{let t=s?e:e.toLowerCase();return new RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),s?"g":"gi").test(h)})),x&&m){let i=this.calculateMatchScore(u.text,t,o,d),h=u.text,x=new Set;o.forEach(e=>{x.has(e.toLowerCase())||(h=this.highlightMatch(h,e,s),x.add(e.toLowerCase()))}),d.forEach(e=>{let t=e.toLowerCase();o.some(e=>e.toLowerCase().includes(t))||x.has(t)||(h=this.highlightMatch(h,e,s),x.add(t))});let m=l?this.getContext(u.text,t,50):void 0;if(n.push({translationId:r.id,translationName:r.name,book:e.name,chapter:c.number,verse:u.number,text:u.text,matchedText:h,context:m,_score:i}),n.length>=a)return n.sort((e,t)=>(t._score||0)-(e._score||0))}}return n.sort((e,t)=>(t._score||0)-(e._score||0))}searchInBook(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{limit:a=100,caseSensitive:l=!1}=r,s=[],n=l?t:t.toLowerCase();for(let r of e.chapters)for(let o of r.verses)if((l?o.text:o.text.toLowerCase()).includes(n)){let n=this.highlightMatch(o.text,t,l);if(s.push({translationId:"",translationName:"",book:e.name,chapter:r.number,verse:o.number,text:o.text,matchedText:n}),s.length>=a)return s}return s}highlightMatch(e,t,r){let a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(r){let t=RegExp("\\b(".concat(a,")\\b"),"g");return e.replace(t,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 font-semibold">$1</mark>')}{let t=RegExp("\\b(".concat(a,")\\b"),"gi");return e.replace(t,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 font-semibold">$1</mark>')}}getContext(e,t,r){let a=e.toLowerCase().indexOf(t.toLowerCase());if(-1===a)return e;let l=Math.max(0,a-r),s=Math.min(e.length,a+t.length+r),n=e.substring(l,s);return l>0&&(n="..."+n),s<e.length&&(n+="..."),n}searchWithTerms(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{matchAll:a=!1,limit:l=100}=r,s=[];for(let r of e)for(let e of r.books)for(let n of e.chapters)for(let o of n.verses){let d=o.text.toLowerCase();if(a?t.every(e=>d.includes(e.toLowerCase())):t.some(e=>d.includes(e.toLowerCase()))){let a=o.text;if(t.forEach(e=>{a=this.highlightMatch(a,e,!1)}),s.push({translationId:r.id,translationName:r.name,book:e.name,chapter:n.number,verse:o.number,text:o.text,matchedText:a}),s.length>=l)return s}}return s}}var j=r(7648),w=r(9376);function N(){let[e,t]=(0,l.useState)(""),[r,n]=(0,l.useState)(!1),[o,d]=(0,l.useState)(!1),[i,c]=(0,l.useState)("all"),[u,h]=(0,l.useState)("all"),[x,m]=(0,l.useState)(!1),[b,p]=(0,l.useState)(-1),{translations:N,current:y}=(0,s.R)(),C=(0,l.useMemo)(()=>new k,[]),S=(0,w.useRouter)(),E=(0,l.useRef)(null),R=(0,l.useRef)(null),D=(0,l.useRef)(null),L=(0,l.useMemo)(()=>{if(!e.trim()||e.length<1)return[];let t=N;"all"!==i&&(t=N.filter(e=>e.id===i));let r=C.searchInTranslations(t,e,{limit:200,caseSensitive:x});return"all"!==u&&(r=r.filter(e=>e.book===u)),r},[e,N,i,u,x,C]),A=(0,l.useCallback)(e=>{t(""),n(!1),p(-1)},[]),z=(0,l.useMemo)(()=>{let e=new Set;return N.forEach(t=>{t.books.forEach(t=>e.add(t.name))}),Array.from(e).sort()},[N]);return(0,l.useEffect)(()=>{if(!r)return;let e=e=>{var t,r;if(0===L.length){"Escape"===e.key&&(n(!1),d(!1),null===(t=E.current)||void 0===t||t.blur());return}switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>e<L.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),p(e=>e>0?e-1:-1);break;case"Enter":if(e.preventDefault(),b>=0&&b<L.length){let e=L[b];S.push("/read?translation=".concat(e.translationId,"&book=").concat(encodeURIComponent(e.book),"&chapter=").concat(e.chapter,"&verse=").concat(e.verse)),A(e)}break;case"Escape":e.preventDefault(),n(!1),d(!1),null===(r=E.current)||void 0===r||r.blur()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,L,b,S,A]),(0,l.useEffect)(()=>{p(-1)},[e,L.length]),(0,l.useEffect)(()=>{if(b>=0&&R.current){let e=R.current.querySelector('[data-result-index="'.concat(b,'"]'));e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[b]),(0,l.useEffect)(()=>{if(!r)return;let e=e=>{let t=e.target;D.current&&!D.current.contains(t)&&(n(!1),d(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),(0,a.jsxs)("div",{ref:D,className:"relative w-full max-w-md",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:18}),(0,a.jsx)("input",{ref:E,type:"text",value:e,onChange:e=>{t(e.target.value),n(!0),p(-1)},onFocus:()=>n(!0),onBlur:e=>{setTimeout(()=>{let t=e.relatedTarget;t&&(!D.current||D.current.contains(t))||null==t||t.closest("a")},150)},placeholder:'Search Bible... (e.g., love, "love your neighbor", love AND peace, love OR joy)',className:"w-full pl-10 pr-20 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-100"}),(0,a.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>d(!o),className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-400 hover:text-neutral-600",title:"Filters",children:(0,a.jsx)(g,{size:16})}),e&&(0,a.jsx)("button",{onClick:()=>{t(""),n(!1)},className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-400 hover:text-neutral-600",children:(0,a.jsx)(f.Z,{size:18})})]})]}),o&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border rounded-lg shadow-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"mb-3 pb-3 border-b dark:border-neutral-700",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2",children:"Search Syntax:"}),(0,a.jsxs)("div",{className:"text-xs text-neutral-600 dark:text-neutral-400 space-y-1",children:[(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love"}),' - Find verses containing "love"']}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:'"love your neighbor"'})," - Exact phrase match"]}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love AND peace"})," - Verses with both words"]}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love OR joy"})," - Verses with either word"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Translation"}),(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full rounded-md border p-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100",children:[(0,a.jsx)("option",{value:"all",children:"All Translations"}),N.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Book"}),(0,a.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full rounded-md border p-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100",children:[(0,a.jsx)("option",{value:"all",children:"All Books"}),z.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"caseSensitive",checked:x,onChange:e=>m(e.target.checked),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"caseSensitive",className:"text-sm",children:"Case sensitive"})]})]}),r&&L.length>0&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border dark:border-neutral-700 rounded-lg shadow-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-2 border-b dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-900/50 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:["Found ",L.length," ",1===L.length?"verse":"verses"]}),(0,a.jsx)("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:"↑↓ to navigate • Enter to select • Esc to close"})]}),(0,a.jsx)("div",{ref:R,className:"max-h-[500px] overflow-y-auto",children:L.map((e,t)=>(0,a.jsx)(j.default,{href:"/read?translation=".concat(e.translationId,"&book=").concat(encodeURIComponent(e.book),"&chapter=").concat(e.chapter,"&verse=").concat(e.verse),onClick:()=>A(e),"data-result-index":t,className:"block px-4 py-3 border-b dark:border-neutral-700 last:border-b-0 transition-colors ".concat(b===t?"bg-brand-50 dark:bg-brand-900/20 border-brand-200 dark:border-brand-800":"hover:bg-neutral-50 dark:hover:bg-neutral-700/50"),children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-brand-600 dark:text-brand-400 mb-1.5",children:[e.translationName," • ",e.book," ",e.chapter,":",e.verse]}),(0,a.jsx)("div",{className:"text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed",dangerouslySetInnerHTML:{__html:e.matchedText}})]})})},"".concat(e.translationId,"-").concat(e.book,"-").concat(e.chapter,"-").concat(e.verse,"-").concat(t)))}),L.length>=200&&(0,a.jsx)("div",{className:"px-4 py-2 border-t dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-900/50 text-xs text-neutral-500 dark:text-neutral-400 text-center",children:"Showing first 200 results. Refine your search for more specific results."})]}),r&&e.length>=1&&0===L.length&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border dark:border-neutral-700 rounded-lg shadow-lg p-4",children:[(0,a.jsxs)("div",{className:"text-center text-sm text-neutral-500 dark:text-neutral-400 mb-2",children:['No results found for "',e,'"']}),(0,a.jsx)("div",{className:"text-xs text-neutral-400 dark:text-neutral-500 text-center",children:"Try: different spelling, fewer words, or check filters"})]})]})}var y=r(8736);let C=(0,n.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),S=(0,n.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var E=r(1827),R=r(5978);class D{getDb(){let{db:e}=(0,E.getFirebase)();if(!e)throw Error("Firebase not initialized");return e}async getNotes(e,t,r,a,l){let s=this.getDb(),n=(0,R.hJ)(s,"users",e,"notes"),o=(0,R.IO)(n,(0,R.ar)("translationId","==",t),(0,R.ar)("book","==",r),(0,R.ar)("chapter","==",a),(0,R.ar)("verse","==",l),(0,R.Xo)("createdAt","desc"));return(await (0,R.PL)(o)).docs.map(e=>{var t,r;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate())||new Date}})}async getAllNotes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=this.getDb(),a=(0,R.hJ)(r,"users",e,"notes"),l=(0,R.IO)(a,(0,R.Xo)("updatedAt","desc"));return(await (0,R.PL)(l)).docs.slice(0,t).map(e=>{var t,r;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate())||new Date}})}async addNote(e,t){let r=this.getDb(),a=(0,R.hJ)(r,"users",e,"notes"),l=new Date,s={...t,createdAt:l,updatedAt:l},n=(0,R.JU)(a);return await (0,R.pl)(n,s),n.id}async updateNote(e,t,r){let a=this.getDb();await (0,R.r7)((0,R.JU)(a,"users",e,"notes",t),{text:r,updatedAt:new Date})}async deleteNote(e,t){let r=this.getDb();await (0,R.oe)((0,R.JU)(r,"users",e,"notes",t))}}function L(e){let{translationId:t,book:r,chapter:s,verse:n,onClose:o}=e,{user:d,isAuthenticated:i}=(0,b.a)(),[c,u]=(0,l.useState)([]),[h,x]=(0,l.useState)(""),[m,p]=(0,l.useState)(null),[v,g]=(0,l.useState)(!1),k=new D;(0,l.useEffect)(()=>{i&&d&&j()},[i,d,t,r,s,n]);let j=async()=>{if(d){g(!0);try{let e=await k.getNotes(d.uid,t,r,s,n);u(e)}catch(e){console.error("Error loading notes:",e)}finally{g(!1)}}},w=async()=>{if(d&&h.trim()){g(!0);try{m?await k.updateNote(d.uid,m,h):await k.addNote(d.uid,{userId:d.uid,translationId:t,book:r,chapter:s,verse:n,text:h}),x(""),p(null),await j()}catch(e){console.error("Error saving note:",e),alert("Failed to save note")}finally{g(!1)}}},N=e=>{x(e.text),p(e.id)},E=async e=>{if(d&&confirm("Delete this note?")){g(!0);try{await k.deleteNote(d.uid,e),await j()}catch(e){console.error("Error deleting note:",e),alert("Failed to delete note")}finally{g(!1)}}};return i&&d?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-neutral-800 rounded-lg max-w-2xl w-full max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(y.Z,{size:20}),"Notes"]}),(0,a.jsxs)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:[r," ",s,":",n]})]}),(0,a.jsx)("button",{onClick:o,className:"text-neutral-500 hover:text-neutral-700 dark:text-neutral-400",children:(0,a.jsx)(f.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[v&&0===c.length?(0,a.jsx)("div",{className:"text-center py-8 text-neutral-500",children:"Loading notes..."}):0===c.length?(0,a.jsx)("div",{className:"text-center py-8 text-neutral-500",children:"No notes yet. Add your first note below!"}):c.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-neutral-50 dark:bg-neutral-700/50 rounded-lg border border-neutral-200 dark:border-neutral-600",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(e.updatedAt).toLocaleString()}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>N(e),className:"text-brand-600 hover:text-brand-700 text-sm",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>E(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:(0,a.jsx)(C,{size:16})})]})]}),(0,a.jsx)("p",{className:"text-neutral-900 dark:text-neutral-100 whitespace-pre-wrap",children:e.text})]},e.id)),(0,a.jsxs)("div",{className:"border-t border-neutral-200 dark:border-neutral-700 pt-4",children:[(0,a.jsx)("textarea",{value:h,onChange:e=>x(e.target.value),placeholder:m?"Edit note...":"Add a note...",className:"w-full p-3 border rounded-md dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100 min-h-[100px]",rows:4}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsxs)("button",{onClick:w,disabled:v||!h.trim(),className:"flex-1 bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,a.jsx)(S,{size:16}),m?"Update":"Save"," Note"]}),m&&(0,a.jsx)("button",{onClick:()=>{x(""),p(null)},className:"px-4 py-2 border rounded-md hover:bg-neutral-50 dark:hover:bg-neutral-700",children:"Cancel"})]})]})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-neutral-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Notes"}),(0,a.jsx)("button",{onClick:o,className:"text-neutral-500 hover:text-neutral-700",children:(0,a.jsx)(f.Z,{size:20})})]}),(0,a.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Please sign in to use notes."}),(0,a.jsx)("button",{onClick:o,className:"mt-4 w-full bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700",children:"Close"})]})})}function A(){var e;let{translations:t,current:r,loadSample:n,loadTranslations:c,setReference:u}=(0,s.R)(),{user:h,isAuthenticated:x}=(0,b.a)(),[v,g]=(0,l.useState)(""),[f,k]=(0,l.useState)(1),[j,w]=(0,l.useState)(1),[y,C]=(0,l.useState)(!1),[S,E]=(0,l.useState)(new Set),R=new p.K;(0,l.useEffect)(()=>{c().catch(()=>{n()})},[]),(0,l.useEffect)(()=>{x&&h&&r&&v&&f&&j&&D()},[x,h,null==r?void 0:r.id,v,f,j]);let D=async()=>{if(h&&r)try{await R.addReadingHistory(h.uid,{translationId:r.id,book:v,chapter:f,verse:j})}catch(e){console.error("Error tracking reading history:",e)}},A=(0,l.useMemo)(()=>{var e;return null!==(e=null==r?void 0:r.books)&&void 0!==e?e:[]},[r]),z=(0,l.useMemo)(()=>{let e=A.find(e=>e.name===v);return e?e.chapters.map(e=>e.number):[]},[A,v]),M=(0,l.useMemo)(()=>{let e=A.find(e=>e.name===v),t=null==e?void 0:e.chapters.find(e=>e.number===f);return t?t.verses.map(e=>e.number):[]},[A,v,f]),I=(0,l.useMemo)(()=>{let e=A.find(e=>e.name===v),t=null==e?void 0:e.chapters.find(e=>e.number===f);return t&&0!==t.verses.length?t.verses:[]},[A,v,f]),{previousChapter:T,nextChapter:F}=(0,l.useMemo)(()=>{let e=[...z].sort((e,t)=>e-t),t=e.indexOf(f);return{previousChapter:t>0?e[t-1]:null,nextChapter:t<e.length-1?e[t+1]:null}},[z,f]);return(0,l.useEffect)(()=>{v&&f&&j&&u({book:v,chapter:f,verse:j})},[v,f,j,u]),(0,l.useEffect)(()=>{let e=document.getElementById("verse-".concat(j));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},[j]),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[320px_1fr]",children:[(0,a.jsx)("aside",{className:"rounded-xl border bg-white p-4 h-fit sticky top-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Search"}),(0,a.jsx)(N,{})]}),(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Translation"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:null!==(e=null==r?void 0:r.id)&&void 0!==e?e:"",onChange:e=>s.R.getState().setCurrent(e.target.value),children:t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,a.jsx)("label",{className:"block text-sm font-medium mt-4",children:"Book"}),(0,a.jsxs)("select",{className:"w-full rounded-md border p-2",value:v,onChange:e=>g(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Select book"}),A.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Chapter"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:f,onChange:e=>k(Number(e.target.value)),children:z.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Start Verse"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:j,onChange:e=>w(Number(e.target.value)),children:M.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]})]})}),(0,a.jsxs)("section",{className:"rounded-xl border bg-white p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-neutral-500",children:[null==r?void 0:r.name," • ",v||"—"," ",f]}),v&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{null!==T&&(k(T),w(1))},disabled:null===T,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(null===T?"bg-neutral-100 text-neutral-400 cursor-not-allowed":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),title:T?"Go to Chapter ".concat(T):"No previous chapter",children:[(0,a.jsx)(o,{size:16}),(0,a.jsx)("span",{children:"Previous"})]}),(0,a.jsxs)("button",{onClick:()=>{null!==F&&(k(F),w(1))},disabled:null===F,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(null===F?"bg-neutral-100 text-neutral-400 cursor-not-allowed":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),title:F?"Go to Chapter ".concat(F):"No next chapter",children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(d,{size:16})]})]})]}),0===I.length?(0,a.jsx)("div",{className:"text-neutral-500 text-center py-12",children:"Choose a book, chapter, and verse."}):(0,a.jsxs)(a.Fragment,{children:[S.size>0&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-brand-50 dark:bg-brand-900/20 border border-brand-300 dark:border-brand-600 rounded-lg flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm text-brand-700 dark:text-brand-400",children:[S.size," ",1===S.size?"verse":"verses"," selected"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>E(new Set),className:"text-sm text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100",children:"Clear"}),(0,a.jsx)(m,{verses:I.filter(e=>S.has(e.number)).map(e=>({verse:e,book:v,chapter:f})),translationName:null==r?void 0:r.name,onCopy:()=>E(new Set)})]})]}),(0,a.jsx)("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:I.map(e=>(0,a.jsx)("div",{onClick:t=>{if(t.ctrlKey||t.metaKey){t.preventDefault();let r=new Set(S);r.has(e.number)?r.delete(e.number):r.add(e.number),E(r)}else w(e.number),E(new Set([e.number]))},className:"cursor-pointer ".concat(S.has(e.number)?"ring-2 ring-brand-500":""),children:(0,a.jsx)(i.i,{verse:e,book:v,chapter:f,isSelected:e.number===j,translationName:null==r?void 0:r.name,translationId:null==r?void 0:r.id,isAuthenticated:x,onNoteClick:()=>{w(e.number),C(!0)}})},e.number))})]})]}),y&&r&&(0,a.jsx)(L,{translationId:r.id,book:v,chapter:f,verse:j,onClose:()=>C(!1)})]})}}},function(e){e.O(0,[358,139,943,379,635,809,756,971,117,744],function(){return e(e.s=6942)}),_N_E=e.O()}]);