(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{6942:function(e,t,r){Promise.resolve().then(r.bind(r,636))},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var a=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:d="",children:c,iconNode:u,...h}=e;return(0,a.createElement)("svg",{ref:t,...l,width:s,height:s,stroke:r,strokeWidth:i?24*Number(o)/Number(s):o,className:n("lucide",d),...h},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{className:i,...d}=r;return(0,a.createElement)(o,{ref:l,iconNode:t,className:n("lucide-".concat(s(e)),i),...d})});return r.displayName="".concat(e),r}},1178:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var a=r(2972),s=r.n(a)},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},636:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var a=r(7437),s=r(2265),n=r(7809),l=r(9205);let o=(0,l.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),i=(0,l.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),d=(0,l.Z)("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);var c=r(1178),u=r(3800),h=r(3144);function m(e){let{translationId:t,book:r,chapter:n,verse:l}=e,{user:o,isAuthenticated:i}=(0,u.a)(),[m,x]=(0,s.useState)(!1),[b,g]=(0,s.useState)(null),[f,p]=(0,s.useState)(!1),v=new h.K;(0,s.useEffect)(()=>{i&&o&&k()},[i,o,t,r,n,l]);let k=async()=>{if(o)try{let e=await v.getBookmark(o.uid,t,r,n,l);x(!!e),g((null==e?void 0:e.id)||null)}catch(e){console.error("Error checking bookmark:",e)}},w=async()=>{if(!i||!o){alert("Please sign in to use bookmarks");return}p(!0);try{if(m&&b)await v.removeBookmark(o.uid,b),x(!1),g(null);else{let e=await v.addBookmark(o.uid,{translationId:t,book:r,chapter:n,verse:l});x(!0),g(e)}}catch(e){console.error("Error toggling bookmark:",e),alert("Failed to update bookmark")}finally{p(!1)}};return i?(0,a.jsx)("button",{onClick:w,disabled:f,className:"p-2 rounded-md hover:bg-neutral-100 transition-colors disabled:opacity-50",title:m?"Remove bookmark":"Add bookmark",children:m?(0,a.jsx)(d,{size:20,className:"text-brand-600"}):(0,a.jsx)(c.Z,{size:20,className:"text-neutral-400"})}):null}let x=(0,l.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),b=(0,l.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var g=r(2489);class f{parseQuery(e){let t;let r=e.trim(),a=[],s=[],n=/"([^"]+)"/g,l=r;for(;null!==(t=n.exec(r));)a.push(t[1]),l=l.replace(t[0],"");let o=l.toUpperCase(),i=o.includes(" AND "),d=o.includes(" OR ");return(l.match(/\b\w+\b/g)||[]).forEach(e=>{let t=e.toUpperCase();"AND"!==t&&"OR"!==t&&s.push(e)}),{phrases:a,words:s,operators:[],useAnd:i&&!d}}calculateMatchScore(e,t,r,a){let s=e.toLowerCase(),n=0;if(r.forEach(e=>{let t=e.toLowerCase();if(s.includes(t)){n+=100;let e=(s.match(RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"))||[]).length;n+=10*e}}),a.forEach(e=>{let t=e.toLowerCase(),r=RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),"gi"),a=(s.match(r)||[]).length;a>0&&(n+=50*a,s.startsWith(t+" ")&&(n+=20))}),0===r.length&&1===a.length){let e=t.toLowerCase();s.includes(e)&&s===e&&(n+=200)}return n}searchInTranslations(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{limit:a=500,includeContext:s=!1,caseSensitive:n=!1}=r,l=[],{phrases:o,words:i,useAnd:d}=this.parseQuery(t.trim());if(0===o.length&&0===i.length)return l;for(let r of e)for(let e of r.books)for(let c of e.chapters)for(let u of c.verses){let h=n?u.text:u.text.toLowerCase(),m=0===o.length||o.every(e=>{let t=n?e:e.toLowerCase();return h.includes(t)}),x=!1;if(x=0===i.length||(d?i.every(e=>{let t=n?e:e.toLowerCase();return new RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),n?"g":"gi").test(h)}):i.some(e=>{let t=n?e:e.toLowerCase();return new RegExp("\\b".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\b"),n?"g":"gi").test(h)})),m&&x){let d=this.calculateMatchScore(u.text,t,o,i),h=u.text,m=new Set;o.forEach(e=>{m.has(e.toLowerCase())||(h=this.highlightMatch(h,e,n),m.add(e.toLowerCase()))}),i.forEach(e=>{let t=e.toLowerCase();o.some(e=>e.toLowerCase().includes(t))||m.has(t)||(h=this.highlightMatch(h,e,n),m.add(t))});let x=s?this.getContext(u.text,t,50):void 0;if(l.push({translationId:r.id,translationName:r.name,book:e.name,chapter:c.number,verse:u.number,text:u.text,matchedText:h,context:x,_score:d}),l.length>=a)return l.sort((e,t)=>(t._score||0)-(e._score||0))}}return l.sort((e,t)=>(t._score||0)-(e._score||0))}searchInBook(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{limit:a=100,caseSensitive:s=!1}=r,n=[],l=s?t:t.toLowerCase();for(let r of e.chapters)for(let o of r.verses)if((s?o.text:o.text.toLowerCase()).includes(l)){let l=this.highlightMatch(o.text,t,s);if(n.push({translationId:"",translationName:"",book:e.name,chapter:r.number,verse:o.number,text:o.text,matchedText:l}),n.length>=a)return n}return n}highlightMatch(e,t,r){let a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(r){let t=RegExp("\\b(".concat(a,")\\b"),"g");return e.replace(t,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 font-semibold">$1</mark>')}{let t=RegExp("\\b(".concat(a,")\\b"),"gi");return e.replace(t,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 font-semibold">$1</mark>')}}getContext(e,t,r){let a=e.toLowerCase().indexOf(t.toLowerCase());if(-1===a)return e;let s=Math.max(0,a-r),n=Math.min(e.length,a+t.length+r),l=e.substring(s,n);return s>0&&(l="..."+l),n<e.length&&(l+="..."),l}searchWithTerms(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{matchAll:a=!1,limit:s=100}=r,n=[];for(let r of e)for(let e of r.books)for(let l of e.chapters)for(let o of l.verses){let i=o.text.toLowerCase();if(a?t.every(e=>i.includes(e.toLowerCase())):t.some(e=>i.includes(e.toLowerCase()))){let a=o.text;if(t.forEach(e=>{a=this.highlightMatch(a,e,!1)}),n.push({translationId:r.id,translationName:r.name,book:e.name,chapter:l.number,verse:o.number,text:o.text,matchedText:a}),n.length>=s)return n}}return n}}var p=r(7648),v=r(9376);function k(){let[e,t]=(0,s.useState)(""),[r,l]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)("all"),[u,h]=(0,s.useState)("all"),[m,k]=(0,s.useState)(!1),[w,y]=(0,s.useState)(-1),{translations:j,current:N}=(0,n.R)(),C=(0,s.useMemo)(()=>new f,[]),E=(0,v.useRouter)(),D=(0,s.useRef)(null),S=(0,s.useRef)(null),A=(0,s.useRef)(null),L=(0,s.useMemo)(()=>{if(!e.trim()||e.length<1)return[];let t=j;"all"!==d&&(t=j.filter(e=>e.id===d));let r=C.searchInTranslations(t,e,{limit:200,caseSensitive:m});return"all"!==u&&(r=r.filter(e=>e.book===u)),r},[e,j,d,u,m,C]),R=(0,s.useCallback)(e=>{t(""),l(!1),y(-1)},[]),I=(0,s.useMemo)(()=>{let e=new Set;return j.forEach(t=>{t.books.forEach(t=>e.add(t.name))}),Array.from(e).sort()},[j]);return(0,s.useEffect)(()=>{if(!r)return;let e=e=>{var t,r;if(0===L.length){"Escape"===e.key&&(l(!1),i(!1),null===(t=D.current)||void 0===t||t.blur());return}switch(e.key){case"ArrowDown":e.preventDefault(),y(e=>e<L.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),y(e=>e>0?e-1:-1);break;case"Enter":if(e.preventDefault(),w>=0&&w<L.length){let e=L[w];E.push("/read?translation=".concat(e.translationId,"&book=").concat(encodeURIComponent(e.book),"&chapter=").concat(e.chapter,"&verse=").concat(e.verse)),R(e)}break;case"Escape":e.preventDefault(),l(!1),i(!1),null===(r=D.current)||void 0===r||r.blur()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,L,w,E,R]),(0,s.useEffect)(()=>{y(-1)},[e,L.length]),(0,s.useEffect)(()=>{if(w>=0&&S.current){let e=S.current.querySelector('[data-result-index="'.concat(w,'"]'));e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[w]),(0,s.useEffect)(()=>{if(!r)return;let e=e=>{let t=e.target;A.current&&!A.current.contains(t)&&(l(!1),i(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),(0,a.jsxs)("div",{ref:A,className:"relative w-full max-w-md",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:18}),(0,a.jsx)("input",{ref:D,type:"text",value:e,onChange:e=>{t(e.target.value),l(!0),y(-1)},onFocus:()=>l(!0),onBlur:e=>{setTimeout(()=>{let t=e.relatedTarget;t&&(!A.current||A.current.contains(t))||null==t||t.closest("a")},150)},placeholder:'Search Bible... (e.g., love, "love your neighbor", love AND peace, love OR joy)',className:"w-full pl-10 pr-20 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-100"}),(0,a.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>i(!o),className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-400 hover:text-neutral-600",title:"Filters",children:(0,a.jsx)(b,{size:16})}),e&&(0,a.jsx)("button",{onClick:()=>{t(""),l(!1)},className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-400 hover:text-neutral-600",children:(0,a.jsx)(g.Z,{size:18})})]})]}),o&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border rounded-lg shadow-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"mb-3 pb-3 border-b dark:border-neutral-700",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-300 mb-2",children:"Search Syntax:"}),(0,a.jsxs)("div",{className:"text-xs text-neutral-600 dark:text-neutral-400 space-y-1",children:[(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love"}),' - Find verses containing "love"']}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:'"love your neighbor"'})," - Exact phrase match"]}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love AND peace"})," - Verses with both words"]}),(0,a.jsxs)("div",{children:["• ",(0,a.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-700 px-1 rounded",children:"love OR joy"})," - Verses with either word"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Translation"}),(0,a.jsxs)("select",{value:d,onChange:e=>c(e.target.value),className:"w-full rounded-md border p-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100",children:[(0,a.jsx)("option",{value:"all",children:"All Translations"}),j.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Book"}),(0,a.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"w-full rounded-md border p-2 text-sm dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100",children:[(0,a.jsx)("option",{value:"all",children:"All Books"}),I.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"caseSensitive",checked:m,onChange:e=>k(e.target.checked),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"caseSensitive",className:"text-sm",children:"Case sensitive"})]})]}),r&&L.length>0&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border dark:border-neutral-700 rounded-lg shadow-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-2 border-b dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-900/50 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:["Found ",L.length," ",1===L.length?"verse":"verses"]}),(0,a.jsx)("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:"↑↓ to navigate • Enter to select • Esc to close"})]}),(0,a.jsx)("div",{ref:S,className:"max-h-[500px] overflow-y-auto",children:L.map((e,t)=>(0,a.jsx)(p.default,{href:"/read?translation=".concat(e.translationId,"&book=").concat(encodeURIComponent(e.book),"&chapter=").concat(e.chapter,"&verse=").concat(e.verse),onClick:()=>R(e),"data-result-index":t,className:"block px-4 py-3 border-b dark:border-neutral-700 last:border-b-0 transition-colors ".concat(w===t?"bg-brand-50 dark:bg-brand-900/20 border-brand-200 dark:border-brand-800":"hover:bg-neutral-50 dark:hover:bg-neutral-700/50"),children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-brand-600 dark:text-brand-400 mb-1.5",children:[e.translationName," • ",e.book," ",e.chapter,":",e.verse]}),(0,a.jsx)("div",{className:"text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed",dangerouslySetInnerHTML:{__html:e.matchedText}})]})})},"".concat(e.translationId,"-").concat(e.book,"-").concat(e.chapter,"-").concat(e.verse,"-").concat(t)))}),L.length>=200&&(0,a.jsx)("div",{className:"px-4 py-2 border-t dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-900/50 text-xs text-neutral-500 dark:text-neutral-400 text-center",children:"Showing first 200 results. Refine your search for more specific results."})]}),r&&e.length>=1&&0===L.length&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-neutral-800 border dark:border-neutral-700 rounded-lg shadow-lg p-4",children:[(0,a.jsxs)("div",{className:"text-center text-sm text-neutral-500 dark:text-neutral-400 mb-2",children:['No results found for "',e,'"']}),(0,a.jsx)("div",{className:"text-xs text-neutral-400 dark:text-neutral-500 text-center",children:"Try: different spelling, fewer words, or check filters"})]})]})}let w=(0,l.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),y=(0,l.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),j=(0,l.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var N=r(1827),C=r(5978);class E{getDb(){let{db:e}=(0,N.getFirebase)();if(!e)throw Error("Firebase not initialized");return e}async getNotes(e,t,r,a,s){let n=this.getDb(),l=(0,C.hJ)(n,"users",e,"notes"),o=(0,C.IO)(l,(0,C.ar)("translationId","==",t),(0,C.ar)("book","==",r),(0,C.ar)("chapter","==",a),(0,C.ar)("verse","==",s),(0,C.Xo)("createdAt","desc"));return(await (0,C.PL)(o)).docs.map(e=>{var t,r;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate())||new Date}})}async getAllNotes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=this.getDb(),a=(0,C.hJ)(r,"users",e,"notes"),s=(0,C.IO)(a,(0,C.Xo)("updatedAt","desc"));return(await (0,C.PL)(s)).docs.slice(0,t).map(e=>{var t,r;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(r=e.data().updatedAt)||void 0===r?void 0:r.toDate())||new Date}})}async addNote(e,t){let r=this.getDb(),a=(0,C.hJ)(r,"users",e,"notes"),s=new Date,n={...t,createdAt:s,updatedAt:s},l=(0,C.JU)(a);return await (0,C.pl)(l,n),l.id}async updateNote(e,t,r){let a=this.getDb();await (0,C.r7)((0,C.JU)(a,"users",e,"notes",t),{text:r,updatedAt:new Date})}async deleteNote(e,t){let r=this.getDb();await (0,C.oe)((0,C.JU)(r,"users",e,"notes",t))}}function D(e){let{translationId:t,book:r,chapter:n,verse:l,onClose:o}=e,{user:i,isAuthenticated:d}=(0,u.a)(),[c,h]=(0,s.useState)([]),[m,x]=(0,s.useState)(""),[b,f]=(0,s.useState)(null),[p,v]=(0,s.useState)(!1),k=new E;(0,s.useEffect)(()=>{d&&i&&N()},[d,i,t,r,n,l]);let N=async()=>{if(i){v(!0);try{let e=await k.getNotes(i.uid,t,r,n,l);h(e)}catch(e){console.error("Error loading notes:",e)}finally{v(!1)}}},C=async()=>{if(i&&m.trim()){v(!0);try{b?await k.updateNote(i.uid,b,m):await k.addNote(i.uid,{userId:i.uid,translationId:t,book:r,chapter:n,verse:l,text:m}),x(""),f(null),await N()}catch(e){console.error("Error saving note:",e),alert("Failed to save note")}finally{v(!1)}}},D=e=>{x(e.text),f(e.id)},S=async e=>{if(i&&confirm("Delete this note?")){v(!0);try{await k.deleteNote(i.uid,e),await N()}catch(e){console.error("Error deleting note:",e),alert("Failed to delete note")}finally{v(!1)}}};return d&&i?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-neutral-800 rounded-lg max-w-2xl w-full max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(w,{size:20}),"Notes"]}),(0,a.jsxs)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:[r," ",n,":",l]})]}),(0,a.jsx)("button",{onClick:o,className:"text-neutral-500 hover:text-neutral-700 dark:text-neutral-400",children:(0,a.jsx)(g.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[p&&0===c.length?(0,a.jsx)("div",{className:"text-center py-8 text-neutral-500",children:"Loading notes..."}):0===c.length?(0,a.jsx)("div",{className:"text-center py-8 text-neutral-500",children:"No notes yet. Add your first note below!"}):c.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-neutral-50 dark:bg-neutral-700/50 rounded-lg border border-neutral-200 dark:border-neutral-600",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(e.updatedAt).toLocaleString()}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>D(e),className:"text-brand-600 hover:text-brand-700 text-sm",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>S(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:(0,a.jsx)(y,{size:16})})]})]}),(0,a.jsx)("p",{className:"text-neutral-900 dark:text-neutral-100 whitespace-pre-wrap",children:e.text})]},e.id)),(0,a.jsxs)("div",{className:"border-t border-neutral-200 dark:border-neutral-700 pt-4",children:[(0,a.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),placeholder:b?"Edit note...":"Add a note...",className:"w-full p-3 border rounded-md dark:bg-neutral-700 dark:border-neutral-600 dark:text-neutral-100 min-h-[100px]",rows:4}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsxs)("button",{onClick:C,disabled:p||!m.trim(),className:"flex-1 bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,a.jsx)(j,{size:16}),b?"Update":"Save"," Note"]}),b&&(0,a.jsx)("button",{onClick:()=>{x(""),f(null)},className:"px-4 py-2 border rounded-md hover:bg-neutral-50 dark:hover:bg-neutral-700",children:"Cancel"})]})]})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-neutral-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Notes"}),(0,a.jsx)("button",{onClick:o,className:"text-neutral-500 hover:text-neutral-700",children:(0,a.jsx)(g.Z,{size:20})})]}),(0,a.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Please sign in to use notes."}),(0,a.jsx)("button",{onClick:o,className:"mt-4 w-full bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700",children:"Close"})]})})}function S(){var e;let{translations:t,current:r,loadSample:l,loadTranslations:d,setReference:c}=(0,n.R)(),{user:x,isAuthenticated:b}=(0,u.a)(),[g,f]=(0,s.useState)(""),[p,v]=(0,s.useState)(1),[y,j]=(0,s.useState)(1),[N,C]=(0,s.useState)(!1),E=new h.K;(0,s.useEffect)(()=>{d().catch(()=>{l()})},[]),(0,s.useEffect)(()=>{b&&x&&r&&g&&p&&y&&S()},[b,x,null==r?void 0:r.id,g,p,y]);let S=async()=>{if(x&&r)try{await E.addReadingHistory(x.uid,{translationId:r.id,book:g,chapter:p,verse:y})}catch(e){console.error("Error tracking reading history:",e)}},A=(0,s.useMemo)(()=>{var e;return null!==(e=null==r?void 0:r.books)&&void 0!==e?e:[]},[r]),L=(0,s.useMemo)(()=>{let e=A.find(e=>e.name===g);return e?e.chapters.map(e=>e.number):[]},[A,g]),R=(0,s.useMemo)(()=>{let e=A.find(e=>e.name===g),t=null==e?void 0:e.chapters.find(e=>e.number===p);return t?t.verses.map(e=>e.number):[]},[A,g,p]),I=(0,s.useMemo)(()=>{let e=A.find(e=>e.name===g),t=null==e?void 0:e.chapters.find(e=>e.number===p);return t&&0!==t.verses.length?t.verses:[]},[A,g,p]),{previousChapter:z,nextChapter:F}=(0,s.useMemo)(()=>{let e=[...L].sort((e,t)=>e-t),t=e.indexOf(p);return{previousChapter:t>0?e[t-1]:null,nextChapter:t<e.length-1?e[t+1]:null}},[L,p]);return(0,s.useEffect)(()=>{g&&p&&y&&c({book:g,chapter:p,verse:y})},[g,p,y,c]),(0,s.useEffect)(()=>{let e=document.getElementById("verse-".concat(y));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},[y]),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[320px_1fr]",children:[(0,a.jsx)("aside",{className:"rounded-xl border bg-white p-4 h-fit sticky top-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Search"}),(0,a.jsx)(k,{})]}),(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Translation"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:null!==(e=null==r?void 0:r.id)&&void 0!==e?e:"",onChange:e=>n.R.getState().setCurrent(e.target.value),children:t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,a.jsx)("label",{className:"block text-sm font-medium mt-4",children:"Book"}),(0,a.jsxs)("select",{className:"w-full rounded-md border p-2",value:g,onChange:e=>f(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Select book"}),A.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Chapter"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:p,onChange:e=>v(Number(e.target.value)),children:L.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Start Verse"}),(0,a.jsx)("select",{className:"w-full rounded-md border p-2",value:y,onChange:e=>j(Number(e.target.value)),children:R.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]})]})}),(0,a.jsxs)("section",{className:"rounded-xl border bg-white p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-neutral-500",children:[null==r?void 0:r.name," • ",g||"—"," ",p]}),g&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{null!==z&&(v(z),j(1))},disabled:null===z,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(null===z?"bg-neutral-100 text-neutral-400 cursor-not-allowed":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),title:z?"Go to Chapter ".concat(z):"No previous chapter",children:[(0,a.jsx)(o,{size:16}),(0,a.jsx)("span",{children:"Previous"})]}),(0,a.jsxs)("button",{onClick:()=>{null!==F&&(v(F),j(1))},disabled:null===F,className:"flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(null===F?"bg-neutral-100 text-neutral-400 cursor-not-allowed":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),title:F?"Go to Chapter ".concat(F):"No next chapter",children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(i,{size:16})]})]})]}),0===I.length?(0,a.jsx)("div",{className:"text-neutral-500 text-center py-12",children:"Choose a book, chapter, and verse."}):(0,a.jsx)("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:I.map(e=>(0,a.jsxs)("div",{id:"verse-".concat(e.number),className:"p-4 rounded-lg transition-colors ".concat(e.number===y?"bg-brand-50 dark:bg-brand-900/20 border-2 border-brand-300 dark:border-brand-600":"bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"text-sm font-semibold text-brand-700 dark:text-brand-400",children:[g," ",p,":",e.number]}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m,{translationId:r.id,book:g,chapter:p,verse:e.number}),b&&(0,a.jsx)("button",{onClick:()=>{j(e.number),C(!0)},className:"p-2 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",title:"Add note",children:(0,a.jsx)(w,{size:18,className:"text-neutral-400"})})]})]}),(0,a.jsx)("div",{className:"text-lg leading-relaxed text-neutral-900 dark:text-neutral-100",children:e.text})]},e.number))})]}),N&&r&&(0,a.jsx)(D,{translationId:r.id,book:g,chapter:p,verse:y,onClose:()=>C(!1)})]})}},3800:function(e,t,r){"use strict";r.d(t,{a:function(){return i}});var a=r(2265),s=r(3301),n=r(1827);class l{async signIn(e,t){let{auth:r}=(0,n.getFirebase)();if(!r)throw Error("Firebase not initialized");return(await (0,s.e5)(r,e,t)).user}async signUp(e,t,r){let{auth:a}=(0,n.getFirebase)();if(!a)throw Error("Firebase not initialized");let l=await (0,s.Xb)(a,e,t);return r&&l.user&&await (0,s.ck)(l.user,{displayName:r}),l.user}async signInWithGoogle(){let{auth:e}=(0,n.getFirebase)();if(!e)throw Error("Firebase not initialized");let t=new s.hJ;return(await (0,s.rh)(e,t)).user}async signOut(){let{auth:e}=(0,n.getFirebase)();if(!e)throw Error("Firebase not initialized");await (0,s.w7)(e)}async resetPassword(e){let{auth:t}=(0,n.getFirebase)();if(!t)throw Error("Firebase not initialized");await (0,s.LS)(t,e)}onAuthStateChange(e){let{auth:t}=(0,n.getFirebase)();return t?(0,s.Aj)(t,e):(e(null),()=>{})}getCurrentUser(){let{auth:e}=(0,n.getFirebase)();return e?e.currentUser:null}}let o=new l;function i(){let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(!0),[n,l]=(0,a.useState)(null);return(0,a.useEffect)(()=>(t(o.getCurrentUser()),s(!1),o.onAuthStateChange(e=>{t(e),s(!1),l(null)})),[]),{user:e,loading:r,error:n,signIn:async(e,r)=>{try{s(!0),l(null);let a=await o.signIn(e,r);return t(a),a}catch(e){throw l(e instanceof Error?e.message:"Failed to sign in"),e}finally{s(!1)}},signUp:async(e,r,a)=>{try{s(!0),l(null);let n=await o.signUp(e,r,a);return t(n),n}catch(e){throw l(e instanceof Error?e.message:"Failed to sign up"),e}finally{s(!1)}},signInWithGoogle:async()=>{try{s(!0),l(null);let e=await o.signInWithGoogle();return t(e),e}catch(e){throw l(e instanceof Error?e.message:"Failed to sign in with Google"),e}finally{s(!1)}},logout:async()=>{try{s(!0),l(null),await o.signOut(),t(null)}catch(e){throw l(e instanceof Error?e.message:"Failed to sign out"),e}finally{s(!1)}},resetPassword:async e=>{try{l(null),await o.resetPassword(e)}catch(e){throw l(e instanceof Error?e.message:"Failed to reset password"),e}},isAuthenticated:!!e}}},3144:function(e,t,r){"use strict";r.d(t,{K:function(){return l}});var a=r(1827),s=r(5978);let n={theme:"auto",fontSize:"medium",defaultTranslation:null,language:"en"};class l{getDb(){let{db:e}=(0,a.getFirebase)();if(!e)throw Error("Firebase not initialized");return e}async getPreferences(e){let t=this.getDb(),r=await (0,s.QT)((0,s.JU)(t,"users",e));if(!r.exists())return n;let a=r.data();return{...n,...a.preferences||{}}}async savePreferences(e,t){let r=this.getDb(),a=(0,s.JU)(r,"users",e),n=await this.getPreferences(e);await (0,s.r7)(a,{preferences:{...n,...t},updatedAt:new Date})}async getBookmarks(e){let t=this.getDb(),r=(0,s.hJ)(t,"users",e,"bookmarks");return(await (0,s.PL)(r)).docs.map(e=>{var t;return{id:e.id,...e.data(),createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date}})}async addBookmark(e,t){let r=this.getDb(),a=(0,s.hJ)(r,"users",e,"bookmarks"),n={...t,createdAt:new Date},l=(0,s.JU)(a);return await (0,s.pl)(l,n),l.id}async removeBookmark(e,t){let r=this.getDb();await (0,s.oe)((0,s.JU)(r,"users",e,"bookmarks",t))}async getBookmark(e,t,r,a,n){var l;let o=this.getDb(),i=(0,s.hJ)(o,"users",e,"bookmarks"),d=(0,s.IO)(i,(0,s.ar)("translationId","==",t),(0,s.ar)("book","==",r),(0,s.ar)("chapter","==",a),(0,s.ar)("verse","==",n)),c=await (0,s.PL)(d);if(c.empty)return null;let u=c.docs[0];return{id:u.id,...u.data(),createdAt:(null===(l=u.data().createdAt)||void 0===l?void 0:l.toDate())||new Date}}async getReadingHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=this.getDb(),a=(0,s.hJ)(r,"users",e,"readingHistory");return(await (0,s.PL)(a)).docs.map(e=>{var t;return{id:e.id,...e.data(),timestamp:(null===(t=e.data().timestamp)||void 0===t?void 0:t.toDate())||new Date}}).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,t)}async addReadingHistory(e,t){let r=this.getDb(),a=(0,s.hJ)(r,"users",e,"readingHistory"),n=await this.getReadingHistoryEntry(e,t.translationId,t.book,t.chapter,t.verse);n?await (0,s.pl)((0,s.JU)(r,"users",e,"readingHistory",n.id),{...t,timestamp:new Date},{merge:!0}):await (0,s.pl)((0,s.JU)(a),{...t,timestamp:new Date})}async getReadingHistoryEntry(e,t,r,a,n){var l;let o=this.getDb(),i=(0,s.hJ)(o,"users",e,"readingHistory"),d=(0,s.IO)(i,(0,s.ar)("translationId","==",t),(0,s.ar)("book","==",r),(0,s.ar)("chapter","==",a),(0,s.ar)("verse","==",n)),c=await (0,s.PL)(d);if(c.empty)return null;let u=c.docs[0];return{id:u.id,...u.data(),timestamp:(null===(l=u.data().timestamp)||void 0===l?void 0:l.toDate())||new Date}}async createUserProfile(e){let t=this.getDb(),r=(0,s.JU)(t,"users",e.uid);if(!(await (0,s.QT)(r)).exists()){var a;await (0,s.pl)(r,{uid:e.uid,email:e.email,displayName:e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"User",createdAt:new Date,preferences:n,role:"user"})}}async getUserRole(e){let t=this.getDb(),r=await (0,s.QT)((0,s.JU)(t,"users",e));return r.exists()&&r.data().role||"user"}async setAdminRole(e,t){let r=this.getDb(),a=(0,s.JU)(r,"users",e);if(!(await (0,s.QT)(a)).exists())throw Error("User profile does not exist. Create user profile first.");await (0,s.r7)(a,{role:t?"admin":"user",updatedAt:new Date})}}}},function(e){e.O(0,[358,139,943,972,379,809,971,117,744],function(){return e(e.s=6942)}),_N_E=e.O()}]);